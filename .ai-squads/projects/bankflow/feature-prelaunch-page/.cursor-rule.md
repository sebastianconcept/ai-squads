---
description: Cursor Integration - Pre-launch Page Feature
type: cursor-rule
status: active
---

# Cursor Rule: Pre-launch Page Feature

## Feature Context
This feature implements a pre-launch page for BankFlow that captures leads (email addresses) for marketing communications while reorganizing existing content to new routes.

## Key Files and Structure
```
crates/site/
├── src/
│   ├── main.rs              # Route definitions and app setup
│   ├── handlers.rs           # Request handlers for all routes
│   ├── templates.rs          # Template structs and implementations
│   └── templates/
│       ├── prelaunch.html    # NEW: Pre-launch page template
│       ├── product.html     # RENAMED: From landing.html
│       └── product-demo.html # RENAMED: From demo.html
```

## Route Structure
- **`/`** → Pre-launch page with lead capture
- **`/product`** → Current landing page content (moved from `/`)
- **`/product/demo`** → Current demo page (moved from `/demo`)
- **`/demo`** → Maintained for backward compatibility
- **`/api/leads`** → NEW: Lead capture API endpoint

## Implementation Guidelines

### 1. Route Updates in main.rs
```rust
fn create_router(state: Arc<AppState>) -> Router {
    Router::new()
        .route("/", get(prelaunch_page))           // NEW: Pre-launch page
        .route("/product", get(product_page))     // MOVED: Existing product page
        .route("/product/demo", get(product_demo_page)) // MOVED: Product demo
        .route("/api/leads", post(handle_lead_capture)) // NEW: Lead capture
        .route("/product/demo/upload", post(handle_demo_upload)) // MOVED: Existing demo upload route
        .route("/product/demo/status/:job_id", get(demo_status)) // MOVED: Existing demo status route
        .route("/product/demo/download/:job_id", get(demo_download)) // MOVED: Existing demo download route
        .route("/health", get(health_check))
        // ... existing layers
}
```

### 2. Template Updates in templates.rs
```rust
#[derive(Template)]
#[template(path = "prelaunch.html")]
pub struct PrelaunchTemplate {
    pub title: String,
    pub value_proposition: String,
}

#[derive(Template)]
#[template(path = "product.html")]
pub struct ProductTemplate {
    pub title: String,
    pub value_proposition: String,
}

#[derive(Template)]
#[template(path = "product-demo.html")]
pub struct ProductDemoTemplate {
    pub title: String,
    pub job_id: Option<String>,
}
```

### 3. Handler Updates in handlers.rs
```rust
pub async fn prelaunch_page() -> impl IntoResponse {
    let template = PrelaunchTemplate::default();
    // ... template rendering logic
}

pub async fn product_page() -> impl IntoResponse {
    let template = ProductTemplate::default();
    // ... template rendering logic
}

pub async fn product_demo_page() -> impl IntoResponse {
    let template = ProductDemoTemplate::default();
    // ... template rendering logic
}

pub async fn handle_lead_capture(
    State(_state): State<std::sync::Arc<AppState>>,
    Form(form): Form<LeadCaptureForm>,
) -> Result<Json<serde_json::Value>, StatusCode> {
    // ... lead capture logic
}
```

## Lead Capture Implementation

### Lead Data Structure
```rust
#[derive(Debug, Deserialize)]
pub struct LeadCaptureForm {
    pub email: String,
    pub name: Option<String>,
}

#[derive(Debug, Serialize, Deserialize)]
pub struct Lead {
    pub email: String,
    pub name: Option<String>,
    pub created_at: chrono::DateTime<chrono::Utc>,
}
```

### Lead Storage
- **Initial Implementation**: File-based storage (CSV or JSON)
- **Location**: `leads/` directory in project root
- **Format**: JSON with timestamp and validation
- **Future**: Database integration when needed

## Design Guidelines

### Pre-launch Page Design
- **Hero Section**: Compelling headline and value proposition
- **Lead Capture Form**: Prominent email signup form
- **Feature Previews**: Teaser of upcoming features
- **Social Proof**: Testimonials or early user feedback
- **Call-to-Action**: Clear next steps for users

### Lead Capture Form
- **Fields**: Email (required), Name (optional)
- **Validation**: Client-side and server-side validation
- **Feedback**: Success/error messages with clear actions
- **Privacy**: Clear privacy policy and data usage
- **Incentive**: Early access benefits clearly communicated

## Quality Standards

### Code Quality
- **Formatting**: `cargo fmt` must pass
- **Linting**: `cargo clippy --all-targets --all-features -- -D warnings`
- **Testing**: `cargo test` must pass
- **Compilation**: `cargo check` must pass

### Template Quality
- **Responsive Design**: Mobile-first approach
- **Accessibility**: Proper semantic HTML and ARIA labels
- **Performance**: Optimized images and minimal dependencies
- **Branding**: Consistent with BankFlow brand guidelines

### Lead Capture Quality
- **Validation**: Robust email validation
- **Security**: Input sanitization and validation
- **Storage**: Reliable lead storage mechanism
- **Privacy**: LGPD compliance considerations

## Testing Requirements

### Route Testing
- [ ] All routes respond correctly
- [ ] Template rendering works for all pages
- [ ] Navigation between pages works
- [ ] Backward compatibility maintained

### Lead Capture Testing
- [ ] Email validation works (valid/invalid formats)
- [ ] Duplicate email prevention works
- [ ] Lead storage mechanism functions
- [ ] Form submission provides feedback
- [ ] Error handling works correctly

### Responsive Testing
- [ ] Mobile design works correctly
- [ ] Tablet design works correctly
- [ ] Desktop design works correctly
- [ ] Form usability on all devices

## Deployment Considerations

### Environment Variables
- **Lead Storage Path**: `LEADS_STORAGE_PATH` (default: `./leads`)
- **Email Validation**: `EMAIL_VALIDATION_STRICT` (default: `true`)
- **Lead Storage Format**: `LEADS_STORAGE_FORMAT` (default: `json`)

### File Permissions
- **Lead Storage Directory**: Must be writable by application
- **Template Files**: Must be readable by application
- **Log Files**: Must be writable by application

### Monitoring
- **Lead Capture Rate**: Track conversion rates
- **Error Rates**: Monitor form submission errors
- **Performance**: Monitor page load times
- **User Behavior**: Track user journey and engagement

## Common Patterns

### Template Rendering
```rust
pub async fn page_handler() -> impl IntoResponse {
    let template = TemplateStruct::default();
    match template.render() {
        Ok(html) => Html(html),
        Err(e) => {
            error!("Template rendering failed: {}", e);
            Html("<h1>Error loading page</h1>".to_string())
        }
    }
}
```

### Form Handling
```rust
pub async fn form_handler(
    State(_state): State<std::sync::Arc<AppState>>,
    Form(form): Form<FormStruct>,
) -> Result<Json<serde_json::Value>, StatusCode> {
    // Validation logic
    // Processing logic
    // Response logic
}
```

### Error Handling
```rust
// Always provide clear error messages
// Log errors for debugging
// Return appropriate HTTP status codes
// Provide user-friendly error responses
```

## Future Enhancements

### Phase 2 Features
- **Database Integration**: Replace file-based storage
- **Email Marketing**: Integration with email service providers
- **Analytics**: Detailed user behavior tracking
- **A/B Testing**: Test different designs and copy

### Phase 3 Features
- **Personalization**: Customized experience based on user profile
- **Advanced Analytics**: Detailed conversion tracking
- **Integration**: Connect with marketing automation tools
- **Scaling**: Prepare for increased traffic and lead volume

## Troubleshooting

### Common Issues
- **Template Not Found**: Check template path and file existence
- **Route Conflicts**: Verify route definitions and order
- **Lead Storage Errors**: Check file permissions and directory existence
- **Validation Failures**: Verify validation logic and error handling

### Debug Commands
```bash
# Check template compilation
cargo check

# Test specific functionality
cargo test

# Format code
cargo fmt

# Lint code
cargo clippy --all-targets --all-features -- -D warnings
```
