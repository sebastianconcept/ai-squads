---
description: Cursor Integration - Deployment Automation Feature
globs:
alwaysApply: false
---

# Deployment Automation Feature - Cursor Integration

## Feature Context

This feature implements comprehensive CI/CD deployment automation for BankFlow using GitHub Actions, Digital Ocean droplets, and automated server setup scripts. The feature includes multi-domain staging and production environments with proper SSL, monitoring, and emergency deployment capabilities.

**Multi-Domain Architecture:**
- **Staging Environment**:
  - qa.conciliaextrato.com (site crate)
  - app.qa.conciliaextrato.com (saas crate)
  - api.qa.conciliaextrato.com (api crate)
- **Production Environment**:
  - conciliaextrato.com (site crate)
  - app.conciliaextrato.com (saas crate)
  - api.conciliaextrato.com (api crate)

## Key Files and Directories

### GitHub Actions Configuration
- `.github/workflows/deploy.yml` - Main CI/CD pipeline configuration
- `.github/workflows/` - Additional workflow files for testing, security, etc.

### Deployment Scripts
- `scripts/setup-droplet.sh` - One-time server setup automation
- `scripts/deploy.sh` - Automated deployment script
- `scripts/backup.sh` - Automated backup procedures
- `scripts/emergency-deploy.sh` - Emergency deployment procedures

### Docker Configuration
- `docker-compose.staging.yml` - Multi-domain staging environment configuration
- `docker-compose.prod.yml` - Multi-domain production environment configuration
- `Dockerfile.site` - Site crate Docker configuration
- `Dockerfile.saas` - SaaS crate Docker configuration
- `Dockerfile.api` - API crate Docker configuration

### Nginx Configuration
- `nginx/nginx.staging.conf` - Staging Nginx configuration
- `nginx/nginx.prod.conf` - Production Nginx configuration
- `nginx/ssl/` - SSL certificate directory

### Environment Configuration
- `env.staging` - Staging environment variables
- `env.prod` - Production environment variables
- `.env.example` - Environment variables template

## Implementation Guidelines

### Code Quality Standards
- All deployment scripts must include proper error handling and logging
- Docker configurations must follow security best practices
- Nginx configurations must include security headers and proper SSL setup
- Environment variables must be properly secured and documented

### Security Requirements
- SSH keys must be properly managed and rotated
- Environment secrets must be stored securely in GitHub secrets
- SSL certificates must be properly configured and auto-renewed
- All deployment activities must be logged and auditable

### Testing Requirements
- All deployment scripts must be tested in staging environment first
- Health checks must be implemented and tested
- Rollback procedures must be tested and validated
- Emergency procedures must be documented and tested

## Agent Responsibilities

### @agent:rusty - Backend Infrastructure
- Implement server setup automation scripts
- Configure Docker Compose files for staging and production
- Implement health check endpoints in application
- Configure monitoring and logging systems

### @agent:scribas - Git Workflow and CI/CD
- Create GitHub Actions CI/CD pipeline
- Implement automated deployment scripts
- Configure branch protection and quality gates
- Implement deployment notifications and metrics

### @agent:team - Coordination and Quality Assurance
- Coordinate team communication and handoffs
- Establish quality standards and procedures
- Create comprehensive documentation and training
- Implement testing and validation procedures

### @agent:moesta - JTBD Validation
- Validate customer jobs and satisfaction gaps
- Conduct team interviews and feedback collection
- Define success metrics and continuous improvement
- Implement customer success tracking

## Development Workflow

### Branch Strategy
- `main` branch: Production deployments to all production domains
- `staging` branch: Staging deployments to all staging domains
- Feature branches: Development and testing before merge

### Deployment Process
1. Feature development in feature branches
2. Merge to staging branch for testing
3. Automatic deployment to all staging domains:
   - qa.conciliaextrato.com (site crate)
   - app.qa.conciliaextrato.com (saas crate)
   - api.qa.conciliaextrato.com (api crate)
4. Testing and validation in staging environment
5. Merge to main branch for production
6. Automatic deployment to all production domains:
   - conciliaextrato.com (site crate)
   - app.conciliaextrato.com (saas crate)
   - api.conciliaextrato.com (api crate)

### Quality Gates
- All tests must pass before deployment
- Security audit must pass before production
- Code quality checks must pass
- Health checks must pass after deployment

## Troubleshooting

### Common Issues
- **Deployment Failures**: Check health checks, logs, and rollback procedures
- **SSL Issues**: Verify Cloudflare configuration and certificate status
- **Environment Variables**: Check GitHub secrets and environment configuration
- **Docker Issues**: Verify Docker Compose configuration and service health

### Emergency Procedures
- **Critical Issues**: Use emergency deployment procedures for quick fixes
- **Rollback**: Use automated rollback procedures to previous version
- **Server Issues**: Use server setup scripts for new droplet provisioning
- **Monitoring**: Check health monitoring and alerting systems

## Documentation

### Required Documentation
- Deployment procedures and runbooks
- Emergency response procedures
- Troubleshooting guides
- Team training materials
- Security and compliance documentation

### Maintenance Procedures
- Regular security updates and patches
- SSL certificate renewal and management
- Backup verification and testing
- Performance monitoring and optimization
- Team training and knowledge sharing

## Success Criteria

### Technical Success
- GitHub Actions CI/CD pipeline operational
- Multi-domain staging and production environments deployed
- Health monitoring and alerting working for all services
- Emergency procedures tested and validated

### Business Success
- Team confidence score 8+ (1-10 scale)
- 80% reduction in manual deployment time
- 99.9% application uptime
- Zero business impact from deployment issues

### Quality Success
- All quality gates passing
- Security audit with no critical vulnerabilities
- Comprehensive documentation and training
- Team trained and confident in new processes
