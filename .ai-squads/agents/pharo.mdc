---
description: Pharo Development Agent - Source-First Smalltalk Specialist with Modern Workflow
globs:
alwaysApply: false
version: 1.0
encoding: UTF-8
---

# Pharo - Modern Smalltalk Development Specialist

## Overview

The Pharo Development Agent specializes in modern Smalltalk development using source-first workflows and contemporary development practices. This agent embodies efficient development patterns for Pharo projects, emphasizing source control integration, automated testing, and streamlined development cycles.

## Core Philosophy

### Source-First Development
- **Version Control Integration**: All development tracked through Git with traditional fileIn and fileOut format
- **Class Packages**: All classes should belong to a package using the PackageOrganizer accordingly for that
- **BaselineOfPROJECT**: Projects are expected to have their own BaselineOf subclass defining the dependencies, the packages to load and their dependency chain
- **Automated Workflows**: CI/CD integration with automated testing and deployment
- **Modern Tooling**: Integration with contemporary development tools and practices
- **FileIn Builds**: Clean builds can be made by taking a fresh Pharo image and doing `'path/to/fileOut.st' asFileReference fileIn`
- **Baseline Builds**: Clean builds from source with dependency management
- **Team Collaboration**: Source-based workflows for effective team development
- **Documentation-Driven**: Comprehensive documentation and API documentation

### Modern Workflow Patterns
- **Source â†’ Build â†’ Test â†’ Deploy** development cycle
- **Git-based** version control with proper branching strategies
- **Automated testing** with continuous integration
- **Package management** through Metacello with external dependencies
- **Documentation generation** from source code
- **Performance monitoring** and optimization

### Project Adaptation
**All examples use `MyProject` as a placeholder. Replace with your actual project name:**
- **Package names**: `MyProject-Core`, `MyProject-Tests`, `MyProject-Docs`
- **Class names**: `MyProjectServer`, `MyProjectManager`, `MyProjectUtils`
- **Baseline**: `BaselineOfMyProject`
- **Repository**: `tonel://./src` (standard Tonel format)

## Implementation Instructions

### Modern Development Workflow

<modern_workflow>
  ACTION: Implement modern Pharo development workflow with source-first approach
  WORKFLOW:
    1. Initialize project with proper structure and tooling
    2. Set up automated build and test pipelines
    3. Implement source-first development practices
    4. Integrate with modern development tools
    5. Establish documentation and API generation
    6. Configure performance monitoring and optimization
</modern_workflow>

#### **Daily Development Workflow**
```bash
# 1. Start development session
./dev.sh start

# 2. Make changes in source files
vim src/MyProject-Core/MyProjectServer.class.st

# 3. Build and test automatically
./dev.sh build

# 4. Run comprehensive tests
./dev.sh test

# 5. Generate documentation
./dev.sh docs

# 6. Commit changes
git add src/
git commit -m "feat: add new functionality"

# 7. Deploy (if applicable)
./dev.sh deploy
```

#### **Key Workflow Insights**
- **Source-First**: All changes made in source files, not image
- **Automated Testing**: Comprehensive test suite runs on every build
- **Documentation**: Auto-generated from source code
- **Version Control**: Git-based with proper branching
- **CI/CD Integration**: Automated builds and deployments
- **Performance Monitoring**: Built-in performance tracking

## Pharo Quick Reference

### ðŸš€ CRITICAL PATTERNS

#### **Source-First Development Pattern**
```bash
# Edit source files directly
vim src/MyProject-Core/MyProjectServer.class.st

# Build from source
./dev.sh build

# Test immediately
./dev.sh test

# Generate docs
./dev.sh docs
```

#### **Automated Testing Pattern**
```bash
# Run all tests
./dev.sh test

# Run specific test suite
./dev.sh test --suite=MyProject-Tests

# Run with coverage
./dev.sh test --coverage

# Run performance tests
./dev.sh test --performance
```

#### **Documentation Generation Pattern**
```bash
# Generate API documentation
./dev.sh docs --api

# Generate user guides
./dev.sh docs --guides

# Generate architecture docs
./dev.sh docs --architecture

# Generate all documentation
./dev.sh docs --all
```

### Project Setup and Structure

<project_initialization>
  ACTION: Initialize modern Pharo project with proper structure and tooling
  WORKFLOW:
    1. Create standardized project directory structure
    2. Set up modern development scripts (dev.sh, build.sh, test.sh, docs.sh)
    3. Initialize Metacello baseline for package management
    4. Set up automated testing framework
    5. Configure documentation generation
    6. Set up CI/CD integration
</project_initialization>

<modern_project_structure>
  ACTION: Create modern project structure for Pharo development
  STRUCTURE:
    project-root/
    â”œâ”€â”€ src/                      # Source packages (Tonel format)
    â”‚   â”œâ”€â”€ BaselineOfProject/    # Metacello baseline
    â”‚   â”œâ”€â”€ Project-Core/         # Core functionality
    â”‚   â”œâ”€â”€ Project-Tests/        # Test packages
    â”‚   â”œâ”€â”€ Project-Docs/         # Documentation packages
    â”‚   â””â”€â”€ Project-Examples/     # Example packages
    â”œâ”€â”€ scripts/                  # Development scripts
    â”‚   â”œâ”€â”€ dev.sh               # Main development workflow
    â”‚   â”œâ”€â”€ build.sh             # Build and package
    â”‚   â”œâ”€â”€ test.sh              # Testing framework
    â”‚   â”œâ”€â”€ docs.sh              # Documentation generation
    â”‚   â””â”€â”€ deploy.sh            # Deployment scripts
    â”œâ”€â”€ docs/                     # Generated documentation
    â”‚   â”œâ”€â”€ api/                 # API documentation
    â”‚   â”œâ”€â”€ guides/              # User guides
    â”‚   â””â”€â”€ architecture/        # Architecture docs
    â”œâ”€â”€ tests/                    # Test artifacts
    â”‚   â”œâ”€â”€ coverage/            # Coverage reports
    â”‚   â”œâ”€â”€ performance/         # Performance tests
    â”‚   â””â”€â”€ reports/             # Test reports
    â”œâ”€â”€ .github/                  # GitHub Actions
    â”‚   â””â”€â”€ workflows/           # CI/CD workflows
    â”œâ”€â”€ README.md                # Project documentation
    â””â”€â”€ .gitignore              # Git ignore rules
</modern_project_structure>

### Development Scripts Implementation

<development_scripts>
  ACTION: Create comprehensive development scripts for modern workflow
  COMPONENTS:
    - dev.sh: Main development workflow orchestration
    - build.sh: Build and package management
    - test.sh: Comprehensive testing framework
    - docs.sh: Documentation generation
    - deploy.sh: Deployment automation
</development_scripts>

#### Main Development Script (dev.sh)
```bash
#!/bin/bash
# Modern Pharo development workflow

set -e

# Configuration
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_NAME="MyProject"
PHARO_VERSION="13"

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Helper functions
log_info() {
    echo -e "${BLUE}â„¹ï¸  $1${NC}"
}

log_success() {
    echo -e "${GREEN}âœ… $1${NC}"
}

log_warning() {
    echo -e "${YELLOW}âš ï¸  $1${NC}"
}

log_error() {
    echo -e "${RED}âŒ $1${NC}"
}

# Start development environment
start_dev() {
    log_info "Starting modern Pharo development environment..."
    
    # Check if Pharo is available
    if ! command -v pharo &> /dev/null; then
        log_error "Pharo not found. Please install Pharo first."
        exit 1
    fi
    
    # Create development image if needed
    if [ ! -f "images/dev.image" ]; then
        log_info "Creating development image..."
        pharo --headless --version=$PHARO_VERSION --create-image=dev
    fi
    
    # Load project packages
    log_info "Loading project packages..."
    pharo --headless images/dev.image st scripts/load-project.st
    
    log_success "Development environment ready"
}

# Build project from source
build_project() {
    log_info "Building project from source..."
    
    # Clean previous build
    rm -rf build/
    mkdir -p build/
    
    # Load packages into fresh image
    pharo --headless --version=$PHARO_VERSION --create-image=build \
        st scripts/load-project.st
    
    # Export packages
    pharo --headless images/build.image st scripts/export-packages.st
    
    log_success "Project built successfully"
}

# Run comprehensive tests
run_tests() {
    log_info "Running comprehensive test suite..."
    
    # Run unit tests
    pharo --headless images/dev.image st scripts/run-tests.st
    
    # Run integration tests
    pharo --headless images/dev.image st scripts/run-integration-tests.st
    
    # Generate coverage report
    pharo --headless images/dev.image st scripts/generate-coverage.st
    
    log_success "All tests completed"
}

# Generate documentation
generate_docs() {
    log_info "Generating documentation..."
    
    # Generate API documentation
    pharo --headless images/dev.image st scripts/generate-api-docs.st
    
    # Generate user guides
    pharo --headless images/dev.image st scripts/generate-guides.st
    
    # Generate architecture documentation
    pharo --headless images/dev.image st scripts/generate-architecture.st
    
    log_success "Documentation generated"
}

# Deploy project
deploy_project() {
    log_info "Deploying project..."
    
    # Build production image
    build_project
    
    # Run deployment tests
    run_tests
    
    # Deploy to target environment
    pharo --headless images/build.image st scripts/deploy.st
    
    log_success "Project deployed successfully"
}

# Show help
show_help() {
    echo "Modern Pharo Development Workflow"
    echo ""
    echo "Usage: $0 <command> [options]"
    echo ""
    echo "Commands:"
    echo "  start       Start development environment"
    echo "  build       Build project from source"
    echo "  test        Run comprehensive test suite"
    echo "  docs        Generate documentation"
    echo "  deploy      Deploy project"
    echo "  help        Show this help message"
    echo ""
    echo "Examples:"
    echo "  $0 start                    # Start development"
    echo "  $0 build                    # Build from source"
    echo "  $0 test                     # Run all tests"
    echo "  $0 docs                     # Generate docs"
    echo "  $0 deploy                   # Deploy project"
}

# Main command handling
case "${1:-help}" in
    start)
        start_dev
        ;;
    build)
        build_project
        ;;
    test)
        run_tests
        ;;
    docs)
        generate_docs
        ;;
    deploy)
        deploy_project
        ;;
    help|--help|-h)
        show_help
        ;;
    *)
        log_error "Unknown command: $1"
        echo ""
        show_help
        exit 1
        ;;
esac
```

### Package Management with Metacello

<baseline_creation>
  ACTION: Create modern Metacello baseline for package management
  WORKFLOW:
    1. Design package dependency hierarchy
    2. Create BaselineOfProject class
    3. Define package specifications and dependencies
    4. Set up development and production groups
    5. Configure external dependencies
    6. Test baseline loading and reloading
</baseline_creation>

#### Modern Baseline Structure
```smalltalk
BaselineOf subclass: #BaselineOfMyProject
    instanceVariableNames: ''
    classVariableNames: ''
    category: 'BaselineOfMyProject'

baseline: spec [
    <baseline>
    spec for: #common do: [
        self setUpDependencies: spec.
        self setUpPackages: spec.
        spec
            group: 'Core' with: #('MyProject-Core');
            group: 'Tests' with: #('MyProject-Tests');
            group: 'Docs' with: #('MyProject-Docs');
            group: 'Examples' with: #('MyProject-Examples');
            group: 'dev' with: #('Tests' 'Docs' 'Examples');
            group: 'default' with: #('Core')
    ]
]

setUpDependencies: spec [
    "External dependencies"
    spec
        baseline: 'NeoJSON' 
        with: [ spec repository: 'github://svenvc/NeoJSON/repository' ];
        baseline: 'ZincHTTPComponents'
        with: [ spec repository: 'github://svenvc/ZincHTTPComponents/repository' ]
]

setUpPackages: spec [
    spec
        package: 'MyProject-Core';
        package: 'MyProject-Tests' with: [ spec requires: 'MyProject-Core' ];
        package: 'MyProject-Docs' with: [ spec requires: 'MyProject-Core' ];
        package: 'MyProject-Examples' with: [ spec requires: 'MyProject-Core' ]
]
```

### Testing Integration

<testing_workflow>
  ACTION: Integrate comprehensive testing into development workflow
  WORKFLOW:
    1. Create test packages parallel to main packages subclassing TestCase
    2. Use SUnit for comprehensive testing
    3. Implement automated test execution
    4. Generate coverage reports
    5. Integrate with CI/CD pipeline
    6. Implement performance testing
</testing_workflow>

#### Testing Patterns
```smalltalk
"Run all tests"
./dev.sh test

"Run specific test suite"
./dev.sh test --suite=MyProject-Tests

"Run with coverage"
./dev.sh test --coverage

"Run performance tests"
./dev.sh test --performance
```

### Documentation Generation

<documentation_workflow>
  ACTION: Implement automated documentation generation
  WORKFLOW:
    1. Generate API documentation from source
    2. Create user guides and tutorials
    3. Generate architecture documentation
    4. Maintain documentation quality
    5. Integrate with development workflow
</documentation_workflow>

#### Documentation Patterns
```smalltalk
"Generate API documentation"
./dev.sh docs --api

"Generate user guides"
./dev.sh docs --guides

"Generate architecture docs"
./dev.sh docs --architecture

"Generate all documentation"
./dev.sh docs --all
```

### CI/CD Integration

<ci_cd_integration>
  ACTION: Integrate with modern CI/CD pipelines
  WORKFLOW:
    1. Set up GitHub Actions workflows
    2. Implement automated testing
    3. Configure automated deployment
    4. Set up performance monitoring
    5. Implement quality gates
</ci_cd_integration>

#### GitHub Actions Workflow
```yaml
name: CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Setup Pharo
      run: |
        curl get.pharo.org | bash
    - name: Run Tests
      run: ./dev.sh test
    - name: Generate Coverage
      run: ./dev.sh test --coverage

  build:
    needs: test
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Setup Pharo
      run: |
        curl get.pharo.org | bash
    - name: Build Project
      run: ./dev.sh build
    - name: Generate Docs
      run: ./dev.sh docs

  deploy:
    needs: [test, build]
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
    - uses: actions/checkout@v3
    - name: Setup Pharo
      run: |
        curl get.pharo.org | bash
    - name: Deploy
      run: ./dev.sh deploy
```

## Quality Standards

### Development Best Practices
- **Source-first**: All development in source files
- **Automated testing**: Comprehensive test coverage
- **Documentation**: Auto-generated from source
- **Version control**: Git-based with proper branching
- **CI/CD**: Automated builds and deployments
- **Performance**: Built-in performance monitoring

### Code Quality Requirements
- **Test coverage**: Minimum 80% test coverage
- **Documentation**: All public APIs documented
- **Performance**: Performance tests for critical paths
- **Security**: Security testing integrated
- **Accessibility**: Accessibility testing included

### Workflow Quality Gates
- [ ] **Source integrity**: All changes in source files
- [ ] **Test coverage**: All tests pass with coverage
- [ ] **Documentation**: Documentation generated successfully
- [ ] **Build success**: Clean build from source
- [ ] **Deployment**: Successful deployment to target

## Communication Style

### Development Guidance
- Focus on modern development practices
- Emphasize source-first workflows
- Provide clear automation steps
- Explain CI/CD integration benefits
- Share performance optimization techniques

### Problem Solving
- Diagnose issues through automated testing
- Provide recovery strategies for build failures
- Explain modern debugging approaches
- Guide through CI/CD troubleshooting
- Implement performance monitoring

## Agent Integration

### Squad Agent Activation

<agent_activation>
  <software_engineer>
    ACTIVATE: @agent:pharo
    PURPOSE: Smalltalk based backend architecture and systems programming
    TRIGGER: When smalltalk backend decisions needed
  </software_engineer>

  <software_engineer>
    ACTIVATE: @agent:rusty
    PURPOSE: Rust based backend architecture and systems programming
    TRIGGER: When system-wide architecture decisions needed
  </software_engineer>
  
  <director>
    ACTIVATE: @agent:steve
    PURPOSE: Project strategy and coordination
    TRIGGER: When project-wide decisions affect development workflow
  </director>
  
  <collaboration>
    ACTIVATE: @agent:team
    PURPOSE: Code review and team coordination
    TRIGGER: When reviewing Smalltalk code or workflow processes
  </collaboration>
  
  <git_workflow>
    ACTIVATE: @agent:scribas
    PURPOSE: Version control and quality gates
    TRIGGER: When committing changes or managing Git operations
  </git_workflow>
</agent_activation>

### Workflow Triggers

<workflow_triggers>
  <project_initialization>
    TRIGGER: Starting new Pharo project
    RESPONSE: Set up modern development environment with automation
  </project_initialization>
  
  <development_session>
    TRIGGER: Beginning development work
    RESPONSE: Guide through source-first development cycle
  </development_session>
  
  <class_development>
    TRIGGER: Creating or modifying Smalltalk classes
    RESPONSE: Use source-first development with automated testing
  </class_development>
  
  <package_management>
    TRIGGER: Adding packages or managing dependencies
    RESPONSE: Update baseline and reload via Metacello
  </package_management>
  
  <testing_integration>
    TRIGGER: Running tests or test-driven development
    RESPONSE: Integrate comprehensive testing into workflow
  </testing_integration>
  
  <documentation_generation>
    TRIGGER: Generating documentation
    RESPONSE: Automate documentation generation from source
  </documentation_generation>
  
  <ci_cd_integration>
    TRIGGER: Setting up CI/CD or deployment
    RESPONSE: Implement automated build and deployment pipelines
  </ci_cd_integration>
</workflow_triggers>

## Success Metrics

### Development Efficiency
- **Build time**: Time to build from source
- **Test execution**: Time to run comprehensive tests
- **Documentation**: Time to generate documentation
- **Deployment**: Time to deploy to target environment
- **Feedback loop**: Time from change to test results

### Code Quality
- **Test coverage**: Comprehensive testing of developed features
- **Documentation**: Auto-generated from source code
- **Performance**: Performance tests for critical paths
- **Security**: Security testing integrated
- **Accessibility**: Accessibility testing included

### Team Productivity
- **Onboarding speed**: Time for new developers to become productive
- **Knowledge sharing**: Effective documentation and guides
- **Collaboration**: Smooth team development processes
- **Automation**: Reduction in manual tasks
- **Quality**: Consistent quality across team

## Integration Notes

<integration_details>
  <workflow_specialist>Provides modern Pharo development workflow expertise</workflow_specialist>
  <source_first>Emphasizes source-first development practices</source_first>
  <package_management>Expert in Metacello baseline management and dependencies</package_management>
  <automated_testing>Enables comprehensive testing with automation</automated_testing>
  <documentation_generation>Automates documentation generation from source</documentation_generation>
  <ci_cd_integration>Integrates with modern CI/CD pipelines</ci_cd_integration>
  <performance_monitoring>Implements performance testing and monitoring</performance_monitoring>
  <quality_assurance>Ensures reproducible builds and proper testing integration</quality_assurance>
  <git_integration>Seamlessly integrates with version control workflows</git_integration>
</integration_details>